# 今日总结  2019-04-14

## 每日一学

### 问题一：

在声明一个新类型之后，声明一个该类型的方法之前，需要先回答以下几个问题：

- 这个类型的本质是什么？
- 如果给这个类型增加或者删除某个值，是要创建一个新值，还是要更改当前的值？
  - 如果是要创建一个新值，那么该类型的方法就使用值接收者；
  - 如果是要修改当前值，那么就使用指针接收者。

这几个问题答案会影响整个程序内部传递这个类型的值的方式：是按值做传递，还是按指针做传递。保持传递的一致性很重要。

这个背后的原则是，不要只关注某个方法是如何处理这个值，而是要关注这个值的本质是什么。

大家仔细看看标准库的两个例子：time.Time   类型和 os.File 类型。

**结论：**

- 是使用值接收者还是指针接收者，不应该由该方法是否修改了接收到的值来决定。这个决策应该基于该类型的本质；
- 这条规则的一个例外是：需要让类型值符合某个接口的时候，即便类型的本质是非原始本质的，也可以选择使用值接收者声明方法。这样做完全符合接口值调用方法的机制。

大家想想为什么Time 类型很多方法都是值类型接收者？

#### **讨论结果：**

1.  某一刻的时间对象应该是唯一，不应该被改变，所以使用值类型接收者。

#### tag

方法接收者



## 知识点学习

### 问题一：

面试题：
[面试题：如何控制并发执行的 Goroutine 的最大数目？很赞的一个答案  - Go语言中文网 -...](https://studygolang.com/topics/8771)
知识星球对代码显示太不友好，所以发布在Go中文网，后续长文都会发布在 Go中文网付费专栏，需要登录才能访问，如果你无法访问，请联系我提供Go中文网用户名。



### 




## 常见坑

#### 问题一：



**讨论结果：**

1. 




## 面试题

### **问题一：**

以下代码是否有问题？

```go
type duration int

func (d *duration) pretty() string {
	return fmt.Sprintf("Duration: %d", *d)
}

func main() {
	duration(42).pretty()
}
```



**讨论结果：**

1. duration(42) 无法取址，不能调用 prerry() 方法；

2. 应该改为

   ```go
   var a duration(42)
   a.pretty()
   ```

   或者修改prerry()方法为值类型接收

   ```go
   func (d duration) pretty() string {
   	return fmt.Sprintf("Duration: %d", d)
   }
   ```

   

#### tag

方法接收者



### 问题二：





**讨论结果：**

1. 




## 同学问的问题

### 问题一：

请问：database/sql 进行 query 查询对 rows 迭代，在没有defer rows.close情况下，正常迭代完成会自动调用close释放连接，我想知道在迭代没有完成时强制break退出循环是否会一直占用该连接，多次调用之后数据库连接池会不会没有新的可用连接

**球主回答：**

1. 按理应该是会耗尽连接。可以是实验下。文档中没说明，长时间不知道会不会自动超时回收，这个得看具体实现。我抽时间实验下，同时尝试看下源码



### 问题二：

各位大佬，求助，我用Go调用diff 怎么总是失败，调用其他的命令，例如 ls, echo 都可以成功，diff ,cmp,sdiff 都无法成功。Google半天看了Dash里的文档无果。

![1556356017729](assets/1556356017729.png)



**球主回答：**

- 多半不在环境变量 path 中。你试试用绝对路径调用 diff



## 今日链接

- [GCTT 出品 |我们必须遵循的 12 个 Go 语言最佳实践](https://mp.weixin.qq.com/s/2uHqw9C02hoLWa-Mmg9RLw) 	tag: go语言设计模式
- 